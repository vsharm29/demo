name: Demo

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop
      - feature/*

jobs:
  parse-variables:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
          
      - name: Set Variables
        run: |
          if [[ ${{ github.ref }} == refs/heads/main* ]]; then
            export variables=parameters/variables-dev.json
          elif [[ ${{ github.ref }} == refs/heads/test* ]]; then
            export variables=parameters/variables-test.json
          elif [[ ${{ github.ref }} == refs/heads/production* ]]; then
            export variables=parameters/variables-prod.json
          else
            export variables=parameters/variables-dev.json
          fi
          export variables=$(jq -r . < $variables)
          export MY_VARIABLE=$(jq -r '.MY_VARIABLE' <<< $variables)
          export ANOTHER_VARIABLE=$(jq -r '.ANOTHER_VARIABLE' <<< $variables)
          export YET_ANOTHER_VARIABLE=$(jq -r '.YET_ANOTHER_VARIABLE' <<< $variables)
          export ARRAY_VARIABLE=$(jq -r '.ARRAY_VARIABLE | join(",")' <<< $variables)
          export OBJECT_VARIABLE=$(jq -r '.OBJECT_VARIABLE | tojson' <<< $variables)

        env:
          MY_VARIABLE: ${{ env.MY_VARIABLE }}
          ANOTHER_VARIABLE: ${{ env.ANOTHER_VARIABLE }}
          YET_ANOTHER_VARIABLE: ${{ env.YET_ANOTHER_VARIABLE }}
          ARRAY_VARIABLE: ${{ env.ARRAY_VARIABLE }}
          OBJECT_VARIABLE: ${{ env.OBJECT_VARIABLE }}
          
      - name: Print Variables
        run: echo "$ANOTHER_VARIABLE"
        env:
          MY_VARIABLE: ${{ env.MY_VARIABLE }}
          ANOTHER_VARIABLE: ${{ env.ANOTHER_VARIABLE }}
          YET_ANOTHER_VARIABLE: ${{ env.YET_ANOTHER_VARIABLE }}
          ARRAY_VARIABLE: ${{ env.ARRAY_VARIABLE }}
          OBJECT_VARIABLE: ${{ env.OBJECT_VARIABLE }}






















# name: Demo

# on:
#   push:
#     branches:
#       - main
#       - develop
#   pull_request:
#     branches:
#       - main
#       - develop
#       - feature/*

# jobs:
#   parse-variables:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v2
          
#       - name: Set Variables
#         run: |
#           if [[ ${{ github.ref }} == refs/heads/main* ]]; then
#             export variables=parameters/variables-dev.json
#           elif [[ ${{ github.ref }} == refs/heads/test* ]]; then
#             export variables=parameters/variables-test.json
#           elif [[ ${{ github.ref }} == refs/heads/production* ]]; then
#             export variables=parameters/variables-prod.json
#           else
#             export variables=parameters/variables-dev.json
#           fi
#           export variables=$(jq -r . < $variables)
#         env:
#           variables: ${{ env.variables }}
          
#       - name: Print Variables
#         run: echo "${{ env.variables }}"
